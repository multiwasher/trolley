<IfModule mod_rewrite.c>
  RewriteEngine On
  
  # Redirect to HTTPS (exceto em localhost)
  RewriteCond %{HTTP_HOST} !^localhost
  RewriteCond %{HTTP:X-Forwarded-Proto} !https
  RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]
  
  # Set proper headers for Service Worker
  <FilesMatch "\.js$">
    Header set Cache-Control "public, max-age=3600"
    Header set X-Content-Type-Options "nosniff"
  </FilesMatch>
  
  # Set proper headers for manifest.json
  <FilesMatch "manifest\.json$">
    Header set Content-Type "application/manifest+json; charset=UTF-8"
    Header set Cache-Control "public, max-age=3600"
    Header set Access-Control-Allow-Origin "*"
  </FilesMatch>
  
  # Set proper headers for HTML
  <FilesMatch "\.html$">
    Header set Cache-Control "public, max-age=1800"
  </FilesMatch>
  
  # Enable gzip compression
  <IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css text/javascript application/javascript application/json
  </IfModule>
</IfModule>
